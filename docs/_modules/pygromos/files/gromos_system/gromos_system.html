<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pygromos.files.gromos_system.gromos_system &mdash; PyGromosTools  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> PyGromosTools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Welcome to PyGromosTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html#define-file-paths">define file paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html#build-gromos-system">Build gromos System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html#run-emin">Run Emin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_source/modules.html">Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">PyGromosTools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      <li>pygromos.files.gromos_system.gromos_system</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pygromos.files.gromos_system.gromos_system</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">File:            gromos_system.py</span>
<span class="sd">Warnings:        this class is WIP!</span>

<span class="sd">Description:</span>

<span class="sd">This is a super class for the collection of all Gromos files used inside a project.</span>
<span class="sd">Bundle files with the system&#39;s topology, coordinates, input parameters, etc. and</span>
<span class="sd">start your simulations from here.</span>

<span class="sd">Author: Marc Lehner, Benjamin Ries, Felix Pultar</span>
<span class="sd">test</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="c1"># Files</span>
<span class="kn">from</span> <span class="nn">pygromos.files._basics._general_gromos_file</span> <span class="kn">import</span> <span class="n">_general_gromos_file</span>
<span class="kn">from</span> <span class="nn">pygromos.files.topology.top</span> <span class="kn">import</span> <span class="n">Top</span>
<span class="kn">from</span> <span class="nn">pygromos.files.coord</span> <span class="kn">import</span> <span class="n">cnf</span>
<span class="kn">from</span> <span class="nn">pygromos.files.coord.cnf</span> <span class="kn">import</span> <span class="n">Cnf</span>
<span class="kn">from</span> <span class="nn">pygromos.files.simulation_parameters.imd</span> <span class="kn">import</span> <span class="n">Imd</span>
<span class="kn">from</span> <span class="nn">pygromos.files.qmmm.qmmm</span> <span class="kn">import</span> <span class="n">QMMM</span>
<span class="kn">from</span> <span class="nn">pygromos.files.topology.disres</span> <span class="kn">import</span> <span class="n">Disres</span>
<span class="kn">from</span> <span class="nn">pygromos.files.topology.ptp</span> <span class="kn">import</span> <span class="n">Pertubation_topology</span>
<span class="kn">from</span> <span class="nn">pygromos.files.coord.refpos</span> <span class="kn">import</span> <span class="n">Reference_Position</span>
<span class="kn">from</span> <span class="nn">pygromos.files.coord.posres</span> <span class="kn">import</span> <span class="n">Position_Restraints</span>
<span class="kn">from</span> <span class="nn">pygromos.files.blocks</span> <span class="kn">import</span> <span class="n">imd_blocks</span>

<span class="c1"># Trajs</span>
<span class="kn">from</span> <span class="nn">pygromos.files.trajectory.trc</span> <span class="kn">import</span> <span class="n">Trc</span>
<span class="kn">from</span> <span class="nn">pygromos.files.trajectory.tre</span> <span class="kn">import</span> <span class="n">Tre</span>
<span class="kn">from</span> <span class="nn">pygromos.files.forcefield._generic_force_field</span> <span class="kn">import</span> <span class="n">_generic_force_field</span>

<span class="c1"># Additional</span>
<span class="c1"># from pygromos.files.forcefield import forcefield_system</span>
<span class="kn">from</span> <span class="nn">pygromos.data.ff</span> <span class="kn">import</span> <span class="n">Gromos54A7</span>
<span class="kn">from</span> <span class="nn">pygromos.gromos</span> <span class="kn">import</span> <span class="n">GromosXX</span><span class="p">,</span> <span class="n">GromosPP</span>
<span class="kn">from</span> <span class="nn">pygromos.utils</span> <span class="kn">import</span> <span class="n">bash</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">pygromos.utils.typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Callable</span>

<span class="k">if</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;rdkit&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
    <span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">AllChem</span>

    <span class="n">has_rdkit</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">has_rdkit</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">skip</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;solute_info&quot;</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">solute_infos</span><span class="p">,</span>
    <span class="s2">&quot;protein_info&quot;</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">protein_infos</span><span class="p">,</span>
    <span class="s2">&quot;non_ligand_info&quot;</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">non_ligand_infos</span><span class="p">,</span>
    <span class="s2">&quot;solvent_info&quot;</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">solvent_infos</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">exclude_pickle</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="Gromos_System"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System">[docs]</a><span class="k">class</span> <span class="nc">Gromos_System</span><span class="p">:</span>
    <span class="n">required_files</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;imd&quot;</span><span class="p">:</span> <span class="n">Imd</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">Top</span><span class="p">,</span> <span class="s2">&quot;cnf&quot;</span><span class="p">:</span> <span class="n">Cnf</span><span class="p">}</span>
    <span class="n">optional_files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;disres&quot;</span><span class="p">:</span> <span class="n">Disres</span><span class="p">,</span>
        <span class="s2">&quot;ptp&quot;</span><span class="p">:</span> <span class="n">Pertubation_topology</span><span class="p">,</span>
        <span class="s2">&quot;posres&quot;</span><span class="p">:</span> <span class="n">Position_Restraints</span><span class="p">,</span>
        <span class="s2">&quot;refpos&quot;</span><span class="p">:</span> <span class="n">Reference_Position</span><span class="p">,</span>
        <span class="s2">&quot;qmmm&quot;</span><span class="p">:</span> <span class="n">QMMM</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">traj_files</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trc&quot;</span><span class="p">:</span> <span class="n">Trc</span><span class="p">,</span> <span class="s2">&quot;tre&quot;</span><span class="p">:</span> <span class="n">Tre</span><span class="p">}</span>

    <span class="n">residue_list</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">solute_info</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">solute_infos</span>
    <span class="n">protein_info</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">protein_infos</span>
    <span class="n">non_ligand_info</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">non_ligand_infos</span>
    <span class="n">solvent_info</span><span class="p">:</span> <span class="n">cnf</span><span class="o">.</span><span class="n">solvent_infos</span>

    <span class="c1"># privates</span>
    <span class="n">_checkpoint_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_last_jobID</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># hpcScheduling ID of the last submitted job.</span>
    <span class="n">_future_promise</span><span class="p">:</span> <span class="nb">bool</span>  <span class="c1"># for interest if multiple jobs shall be chained.</span>
    <span class="n">_future_promised_files</span><span class="p">:</span> <span class="nb">list</span>

    <span class="n">_single_multibath</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_single_energy_group</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="c1"># if this class Variable is set to True, all binary checks will be removed from the systems.</span>
    <span class="n">_gromos_binary_checks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_gromosPP_bin_dir</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_gromosXX_bin_dir</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_gromosPP</span><span class="p">:</span> <span class="n">GromosPP</span>
    <span class="n">_gromosXX</span><span class="p">:</span> <span class="n">GromosXX</span>

<div class="viewcode-block" id="Gromos_System.__init__"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">work_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">system_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rdkitMol</span><span class="p">:</span> <span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">Mol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_mol2_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">readIn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">forcefield</span><span class="p">:</span> <span class="n">_generic_force_field</span> <span class="o">=</span> <span class="n">_generic_force_field</span><span class="p">(),</span>
        <span class="n">auto_convert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">adapt_imd_automatically</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">in_smiles</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_residue_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_top_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_cnf_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_imd_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_disres_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_ptp_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_posres_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_refpos_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_qmmm_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_gromosXX_bin_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_gromosPP_bin_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The Gromos_System class is the central unit of PyGromosTools for files and states.</span>
<span class="sd">            With this class all files can be read-in or the files can be automatically generated from smiles.</span>
<span class="sd">            Additionally to that can all gromos++ functions be used from the Gromos System, so system generation can be easily accomplished.</span>

<span class="sd">            if you want to remove all binary checks, do the following:</span>
<span class="sd">            &gt;&gt;&gt; from pygromos.files.gromos_system.gromos_system import Gromos_System</span>
<span class="sd">            &gt;&gt;&gt; Gromos_System._gromos_noBinary_checks = True</span>
<span class="sd">            &gt;&gt;&gt; sys = Gromos_System()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        work_folder : str</span>
<span class="sd">            This gives the initial working folder for the system.</span>
<span class="sd">        system_name : str</span>
<span class="sd">            the name of the system, also used as file prefix</span>
<span class="sd">        in_smiles : str, optional</span>
<span class="sd">            Molecule input SMILES for file generation, by default None</span>
<span class="sd">        in_top_path : str, optional</span>
<span class="sd">            input Gromos topology path (.top), by default None</span>
<span class="sd">        in_cnf_path : str, optional</span>
<span class="sd">            input Gromos coordinate path (.cnf), by default None</span>
<span class="sd">        in_imd_path : str, optional</span>
<span class="sd">            input Gromos simulation parameters path (.imd), by default None</span>
<span class="sd">        in_disres_path : str, optional</span>
<span class="sd">            input Gromos distance restraint path (.disres), by default None</span>
<span class="sd">        in_ptp_path : str, optional</span>
<span class="sd">            input pertubation file for free energy calculations (.ptp), by default None</span>
<span class="sd">        in_posres_path : str, optional</span>
<span class="sd">            input position restraints file (.por), by default None</span>
<span class="sd">        in_qmmm_path: str, optional</span>
<span class="sd">            qmmm parameter file (.qmmm), by default None</span>
<span class="sd">        in_refpos_path : str, optional</span>
<span class="sd">            input reference position file (.rpf), by default None</span>
<span class="sd">        in_gromosXX_bin_dir : str, optional</span>
<span class="sd">            path to the binary dir of GromosXX, by default None -&gt; uses the set binaries in the PATH variable</span>
<span class="sd">        in_gromosPP_bin_dir : str, optional</span>
<span class="sd">            path to the binary dir of GromosPP, by default None -&gt; uses the set binaries in the PATH variable</span>
<span class="sd">        rdkitMol : Chem.rdchem.Mol, optional</span>
<span class="sd">            input rdkit Molecule, by default None</span>
<span class="sd">        in_mol2_file : str, optional</span>
<span class="sd">            path to input mol2 file, by default None</span>
<span class="sd">        readIn : bool, optional</span>
<span class="sd">            readIn all provided files?, by default True</span>
<span class="sd">        Forcefield : forcefield_system, optional</span>
<span class="sd">            input PyGromos - forcefield Class , by default forcefield_system()</span>
<span class="sd">        auto_convert : bool, optional</span>
<span class="sd">            automatically convert rdkit MOL and smiles to gromos files, by default False</span>
<span class="sd">        adapt_imd_automatically : bool, optional</span>
<span class="sd">            adjust the input imd file to the GromosSystem, by default True</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Stay a while and listen!, by default False</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Warning</span>
<span class="sd">            Rises warning if files are not present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">system_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span> <span class="o">=</span> <span class="n">work_folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">in_smiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_residue_list</span> <span class="o">=</span> <span class="n">in_residue_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span> <span class="o">=</span> <span class="n">forcefield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_mol2_file</span> <span class="o">=</span> <span class="n">in_mol2_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_jobID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd_automatically</span> <span class="o">=</span> <span class="n">adapt_imd_automatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_single_multibath</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_single_energy_group</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># use setter functions that perform additional sanity checks</span>
        <span class="c1"># and also set the correct directory paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gromosPP</span> <span class="o">=</span> <span class="n">in_gromosPP_bin_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gromosXX</span> <span class="o">=</span> <span class="n">in_gromosXX_bin_dir</span>

        <span class="c1"># add functions of gromosPP to system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bind_gromosPPFuncs</span><span class="p">()</span>

        <span class="c1"># For HPC-Queueing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">in_smiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rdkitMol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">in_mol2_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">readIn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No data provided to gromos_system</span><span class="se">\n</span><span class="s2">manual work needed&quot;</span><span class="p">)</span>

        <span class="c1"># import files:</span>
        <span class="n">file_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;imd&quot;</span><span class="p">:</span> <span class="n">in_imd_path</span><span class="p">,</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">in_top_path</span><span class="p">,</span>
            <span class="s2">&quot;ptp&quot;</span><span class="p">:</span> <span class="n">in_ptp_path</span><span class="p">,</span>
            <span class="s2">&quot;cnf&quot;</span><span class="p">:</span> <span class="n">in_cnf_path</span><span class="p">,</span>
            <span class="s2">&quot;disres&quot;</span><span class="p">:</span> <span class="n">in_disres_path</span><span class="p">,</span>
            <span class="s2">&quot;posres&quot;</span><span class="p">:</span> <span class="n">in_posres_path</span><span class="p">,</span>
            <span class="s2">&quot;refpos&quot;</span><span class="p">:</span> <span class="n">in_refpos_path</span><span class="p">,</span>
            <span class="s2">&quot;qmmm&quot;</span><span class="p">:</span> <span class="n">in_qmmm_path</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_attribute_files</span><span class="p">(</span><span class="n">file_mapping</span><span class="p">,</span> <span class="n">readIn</span><span class="o">=</span><span class="n">readIn</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># System Information:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span><span class="o">.</span><span class="n">_future_file</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span><span class="o">.</span><span class="n">get_system_information</span><span class="p">(</span><span class="n">not_ligand_residues</span><span class="o">=</span><span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># import molecule from smiles using rdkit</span>
        <span class="k">if</span> <span class="n">in_smiles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">in_smiles</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMolecule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="n">AllChem</span><span class="o">.</span><span class="n">UFFOptimizeMolecule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">in_mol2_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromMol2File</span><span class="p">(</span><span class="n">in_mol2_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># import  molecule from RDKit</span>
        <span class="k">if</span> <span class="n">rdkitMol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">rdkitMol</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smiles</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># automate all conversions for rdkit mols or mol2 if possible</span>
        <span class="k">if</span> <span class="n">auto_convert</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">auto_convert</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;auto_convert active but no data provided -&gt; auto_convert NOT done!&quot;</span><span class="p">)</span>

        <span class="c1"># decide if the imd should be adapted (force groups etc.)</span>
        <span class="c1"># assert if the respective option is activated and cnf/imd files do actually exist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd_automatically</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span><span class="o">.</span><span class="n">_future_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">_future_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd</span><span class="p">()</span>

        <span class="c1"># misc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="p">))</span>

        <span class="c1"># Empty Attr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;GROMOS SYSTEM: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">spacer</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;WORKDIR: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;LAST CHECKPOINT: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;GromosXX_bin: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gromosXX_bin_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;GromosPP_bin: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gromosPP_bin_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;FILES: </span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_file_paths</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;FUTURE PROMISE: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;solute_info&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;protein_info&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;non_ligand_info&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;solvent_info&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;SYSTEM: </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;protein_info&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_residues</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;protein_info&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># +&quot; resIDs: &quot;+str(self.protein_info.residues[0])+&quot;-&quot;+str(self.protein_info.residues[-1])</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">PROTEIN:</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  nresidues: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_residues</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot; natoms: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;solute_info&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">LIGANDS:</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  resID: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  natoms: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;non_ligand_info&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># +&quot;  resID: &quot;+str(self.non_ligand_info.positions)</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Non-LIGANDS:</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  nmolecules: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  natoms: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;solvent_info&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># &quot; resIDs: &quot;+str(self.solvent_info.positions[0])+&quot;-&quot;+str(self.solvent_info.positions[-1])+</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">SOLVENT:</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  nmolecules: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  natoms: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;solute_info&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Solute:</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  resID: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  natoms: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;solvent_info&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># &quot; resIDs: &quot;+str(self.solvent_info.positions[0])+&quot;-&quot;+str(self.solvent_info.positions[-1])+</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">SOLVENT:</span><span class="se">\t</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  nmolecules: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;  natoms: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        preperation for pickling:</span>
<span class="sd">        remove the non trivial pickling parts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attribute_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attribute_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># traj file is not loaded</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># traj file was loaded</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">path</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_pickle</span><span class="p">:</span>
                <span class="n">new_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]})</span>
            <span class="k">elif</span> <span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">skip</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_pickle</span><span class="p">:</span>
                <span class="n">new_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">attribute_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

            <span class="n">new_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;_traj_files_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">new_dict</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">skip</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

        <span class="c1"># misc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="p">))</span>

        <span class="c1"># init_traj attr:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span> <span class="o">=</span> <span class="n">GromosPP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP_bin_dir</span><span class="p">,</span> <span class="n">_check_binary_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX</span> <span class="o">=</span> <span class="n">GromosXX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX_bin_dir</span><span class="p">,</span> <span class="n">_check_binary_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__bind_gromosPPFuncs</span><span class="p">()</span>

        <span class="c1"># are promised files now present?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_promises</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="n">copy_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">system_name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">work_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span><span class="p">,</span> <span class="n">readIn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">copy_obj</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="n">copy_obj</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">copy_obj</span>

<div class="viewcode-block" id="Gromos_System.copy"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Properties</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">work_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span>

    <span class="nd">@work_folder</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">work_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span> <span class="o">=</span> <span class="n">work_folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_all_file_paths</span><span class="p">()</span>

    <span class="c1"># Updates the work folder without updating all file paths</span>
<div class="viewcode-block" id="Gromos_System.work_folder_no_update"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.work_folder_no_update">[docs]</a>    <span class="k">def</span> <span class="nf">work_folder_no_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span> <span class="o">=</span> <span class="n">work_folder</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">system_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_general_gromos_file</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_file_paths</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_file_paths</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Top</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top</span>

    <span class="nd">@top</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Top</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">Top</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">Top</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Top</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cnf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cnf</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span>

    <span class="nd">@cnf</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cnf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Cnf</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span> <span class="o">=</span> <span class="n">Cnf</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span><span class="o">.</span><span class="n">get_residues</span><span class="p">()</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span><span class="o">.</span><span class="n">get_system_information</span><span class="p">(</span><span class="n">not_ligand_residues</span><span class="o">=</span><span class="p">[])</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span> <span class="o">=</span> <span class="n">Cnf</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cnf&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Cnf</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cnf</span> <span class="o">=</span> <span class="n">input_value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">imd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Imd</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imd</span>

    <span class="nd">@imd</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">imd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Imd</span><span class="p">]):</span>
        <span class="c1"># Make sure the new Imd (str or Imd object) is updated only if the option</span>
        <span class="c1"># has been enabled (adapt_imd_automatically) and actually has coordinates</span>
        <span class="c1"># data that could be used to adapt the imd</span>
        <span class="n">is_adaptable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd_automatically</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">_future_file</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imd</span> <span class="o">=</span> <span class="n">Imd</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_adaptable</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_imd</span> <span class="o">=</span> <span class="n">Imd</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;imd&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Imd</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imd</span> <span class="o">=</span> <span class="n">input_value</span>
            <span class="k">if</span> <span class="n">is_adaptable</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">refpos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Reference_Position</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpos</span>

    <span class="nd">@refpos</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">refpos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Reference_Position</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_refpos</span> <span class="o">=</span> <span class="n">Reference_Position</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_refpos</span> <span class="o">=</span> <span class="n">Reference_Position</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;refpos&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Reference_Position</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refpos</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">elif</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refpos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">posres</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Position_Restraints</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_posres</span>

    <span class="nd">@posres</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">posres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Position_Restraints</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_posres</span> <span class="o">=</span> <span class="n">Position_Restraints</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_posres</span> <span class="o">=</span> <span class="n">Position_Restraints</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;posres&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Position_Restraints</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_posres</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">elif</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_posres</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">disres</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Disres</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disres</span>

    <span class="nd">@disres</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">disres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Disres</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_disres</span> <span class="o">=</span> <span class="n">Disres</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Disres</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disres</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ptp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pertubation_topology</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ptp</span>

    <span class="nd">@ptp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ptp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Pertubation_topology</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ptp</span> <span class="o">=</span> <span class="n">Pertubation_topology</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Pertubation_topology</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ptp</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Trc</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;trc&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">_future_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="o">=</span> <span class="n">Trc</span><span class="p">(</span><span class="n">traj_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;trc&quot;</span><span class="p">],</span> <span class="n">in_cnf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;trc&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="o">=</span> <span class="n">Trc</span><span class="p">(</span><span class="n">traj_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;trc&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span>

    <span class="nd">@trc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">trc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Trc</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">in_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;trc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trc</span> <span class="o">=</span> <span class="n">in_value</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">in_value</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;trc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tre</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tre</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;tre&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span> <span class="o">=</span> <span class="n">Tre</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;tre&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span>

    <span class="nd">@tre</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tre</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">in_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;tre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tre</span> <span class="o">=</span> <span class="n">in_value</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">in_value</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_traj_files_path</span><span class="p">[</span><span class="s2">&quot;tre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qmmm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QMMM</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qmmm</span>

    <span class="nd">@qmmm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">qmmm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QMMM</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_qmmm</span> <span class="o">=</span> <span class="n">QMMM</span><span class="p">(</span><span class="n">in_value</span><span class="o">=</span><span class="n">input_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Could not find file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">QMMM</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qmmm</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">elif</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qmmm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse input type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gromosXX_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX_bin_dir</span>

    <span class="nd">@gromosXX_bin_dir</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">gromosXX_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gromosXX</span><span class="o">.</span><span class="n">bin</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX_bin_dir</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gromosPP_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP_bin_dir</span>

    <span class="nd">@gromosPP_bin_dir</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">gromosPP_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gromosPP</span><span class="o">.</span><span class="n">bin</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP_bin_dir</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gromosXX</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GromosXX</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX</span>

    <span class="nd">@gromosXX</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">gromosXX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GromosXX</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX</span> <span class="o">=</span> <span class="n">GromosXX</span><span class="p">(</span><span class="n">gromosXX_bin_dir</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_check_binary_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX_bin_dir</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">GromosXX</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX</span> <span class="o">=</span> <span class="n">input_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX</span><span class="o">.</span><span class="n">_check_binary_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosXX_bin_dir</span> <span class="o">=</span> <span class="n">input_value</span><span class="o">.</span><span class="n">bin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse input type:  </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gromosPP</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GromosPP</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span>

    <span class="nd">@gromosPP</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">gromosPP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GromosPP</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span> <span class="o">=</span> <span class="n">GromosPP</span><span class="p">(</span><span class="n">gromosPP_bin_dir</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span> <span class="n">_check_binary_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP_bin_dir</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">GromosPP</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span> <span class="o">=</span> <span class="n">input_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span><span class="o">.</span><span class="n">_check_binary_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP_bin_dir</span> <span class="o">=</span> <span class="n">input_value</span><span class="o">.</span><span class="n">bin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse input type:  </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_value</span><span class="p">))</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    System generation</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Gromos_System.get_script_generation_command"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.get_script_generation_command">[docs]</a>    <span class="k">def</span> <span class="nf">get_script_generation_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_prefixes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_prefixes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">gen_cmd</span> <span class="o">=</span> <span class="s2">&quot;#Generate &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;from &quot;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span>
            <span class="o">+</span> <span class="s2">&quot; import &quot;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="o">+</span> <span class="s2">&quot; as &quot;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="o">+</span> <span class="s2">&quot;_class&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_gromos_binary_checks&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span><span class="p">:</span>
            <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;_class._gromos_binary_checks = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromos_binary_checks</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">var_name</span>
            <span class="o">+</span> <span class="s2">&quot; = &quot;</span>
            <span class="o">+</span> <span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="o">+</span> <span class="s1">&#39;_class(work_folder=&quot;&#39;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span>
            <span class="o">+</span> <span class="s1">&#39;&quot;, system_name=&quot;&#39;</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="o">+</span> <span class="s1">&#39;&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_file_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; = &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gromosXX_bin_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.gromosXX_bin_dir = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gromosXX_bin_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gromosPP_bin_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.gromosPP_bin_dir = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gromosXX_bin_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">gen_cmd</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">gen_cmd</span></div>

<div class="viewcode-block" id="Gromos_System.parse_attribute_files"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.parse_attribute_files">[docs]</a>    <span class="k">def</span> <span class="nf">parse_attribute_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_mapping</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">readIn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function sets dynamically builds the output folder, the file objs of this class and checks their dependencies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_mapping: Dict[str, Union[str, None]]</span>
<span class="sd">            attribute name: input path</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># File/Folder Attribute managment</span>
        <span class="n">check_file_paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check if system folder is present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span><span class="p">):</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span><span class="p">)</span>
        <span class="n">check_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span><span class="p">)</span>

        <span class="c1"># Check if file- paths are valid</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">all_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="p">)</span>
        <span class="p">[</span><span class="n">check_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">file_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check_file_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">check_path_dependencies</span><span class="p">(</span><span class="n">check_file_paths</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># SET Attribute-FILES</span>
        <span class="k">for</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">readIn</span> <span class="ow">and</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing File: &quot;</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">all_files</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">](</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attribute_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generate Empty: &quot;</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">all_files</span><span class="p">[</span><span class="n">attribute_name</span><span class="p">](</span><span class="kc">None</span><span class="p">,</span> <span class="n">_future_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">file_path</span>
                <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>

        <span class="c1"># if read in of files - try to adapt the imd file necessaries</span>

    <span class="k">def</span> <span class="nf">_update_all_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">file_name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">_future_file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Did not change file path as its only promised &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_obj</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file_obj</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">_gromos_file_ending</span>
                    <span class="p">)</span>

<div class="viewcode-block" id="Gromos_System.rebase_files"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.rebase_files">[docs]</a>    <span class="k">def</span> <span class="nf">rebase_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span><span class="p">)):</span>
            <span class="n">bash</span><span class="o">.</span><span class="n">make_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_all_file_paths</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_files</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_check_promises</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># misc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="k">for</span> <span class="n">promised_file_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="p">:</span>
            <span class="n">promised_file</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">promised_file_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">promised_file</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;READING FILE&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">promised_file_key</span> <span class="o">==</span> <span class="s2">&quot;trc&quot;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span>
                        <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">promised_file_key</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span><span class="p">[</span><span class="n">promised_file_key</span><span class="p">](</span><span class="n">traj_path</span><span class="o">=</span><span class="n">promised_file</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">in_cnf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">promised_file_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_files</span><span class="p">[</span><span class="n">promised_file_key</span><span class="p">](</span><span class="n">promised_file</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">promised_file_key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Promised file was not found: &quot;</span> <span class="o">+</span> <span class="n">promised_file_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_future_promised_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_future_promise</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Gromos_System.auto_convert"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.auto_convert">[docs]</a>    <span class="k">def</span> <span class="nf">auto_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># init forcefield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">auto_import_ff</span><span class="p">()</span>

        <span class="c1"># find all kwargs</span>
        <span class="n">ff_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;work_folder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ff_kwargs</span><span class="p">[</span><span class="s2">&quot;smiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smiles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mol2_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ff_kwargs</span><span class="p">[</span><span class="s2">&quot;in_mol2_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_mol2_file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_residue_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ff_kwargs</span><span class="p">[</span><span class="s2">&quot;residue_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_residue_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;amberff_gaff&quot;</span><span class="p">:</span>
            <span class="n">ff_kwargs</span><span class="p">[</span><span class="s2">&quot;gromosPP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gromosPP</span>

        <span class="c1"># convert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">create_top</span><span class="p">(</span><span class="n">mol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">in_top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="o">**</span><span class="n">ff_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">create_cnf</span><span class="p">(</span><span class="n">mol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">in_cnf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="p">,</span> <span class="o">**</span><span class="n">ff_kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gromos_System.rdkit2GromosName"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.rdkit2GromosName">[docs]</a>    <span class="k">def</span> <span class="nf">rdkit2GromosName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;please find your own way to get the Gromos Name for your molecule.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gromos_System.prepare_for_simulation"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.prepare_for_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_for_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">not_ligand_residues</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adapt_imd</span><span class="p">(</span><span class="n">not_ligand_residues</span><span class="o">=</span><span class="n">not_ligand_residues</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gromos_System.adapt_imd"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.adapt_imd">[docs]</a>    <span class="k">def</span> <span class="nf">adapt_imd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">not_ligand_residues</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="c1"># Get residues</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">_future_file</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The residue_list, solute_info, protein_info adn non_ligand_info are required for automatic imd-adaptation.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">_future_file</span><span class="p">:</span>
                <span class="n">cres</span><span class="p">,</span> <span class="n">lig</span><span class="p">,</span> <span class="n">prot</span><span class="p">,</span> <span class="n">nonLig</span><span class="p">,</span> <span class="n">solvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">get_system_information</span><span class="p">(</span>
                    <span class="n">not_ligand_residues</span><span class="o">=</span><span class="n">not_ligand_residues</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span> <span class="o">=</span> <span class="n">cres</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span> <span class="o">=</span> <span class="n">lig</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span> <span class="o">=</span> <span class="n">prot</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span> <span class="o">=</span> <span class="n">nonLig</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span> <span class="o">=</span> <span class="n">solvent</span>
        <span class="c1"># System</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">NPM</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">NSM</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span><span class="p">[</span><span class="s2">&quot;SOLV&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;SOLV&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_list</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># boundary condition:</span>
        <span class="kn">from</span> <span class="nn">pygromos.files.blocks.coord_blocks</span> <span class="kn">import</span> <span class="n">Pbc</span>

        <span class="c1"># vacuum if no box or GENBOX-pbc == Vacuum</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">_future_file</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="p">,</span> <span class="s2">&quot;GENBOX&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">GENBOX</span><span class="o">.</span><span class="n">pbc</span> <span class="o">==</span> <span class="n">Pbc</span><span class="o">.</span><span class="n">vacuum</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">BOUNDCOND</span><span class="o">.</span><span class="n">NTB</span> <span class="o">=</span> <span class="n">Pbc</span><span class="o">.</span><span class="n">vacuum</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">_future_file</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="p">,</span> <span class="s2">&quot;GENBOX&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">GENBOX</span><span class="o">.</span><span class="n">pbc</span> <span class="o">==</span> <span class="n">Pbc</span><span class="o">.</span><span class="n">rectangular</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">BOUNDCOND</span><span class="o">.</span><span class="n">NTB</span> <span class="o">=</span> <span class="n">Pbc</span><span class="o">.</span><span class="n">rectangular</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">BOUNDCOND</span><span class="o">.</span><span class="n">NDFMIN</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Energy and Force Group</span>
        <span class="n">energy_groups</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_energy_group</span><span class="p">:</span>
            <span class="n">energy_groups</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># solute</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">energy_groups</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">})</span>
            <span class="c1"># protein</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">energy_groups</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">start_position</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">})</span>
            <span class="c1"># ligand</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">solv_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solv_add</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># solvent</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">energy_groups</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_groups</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="n">energy_groups</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">max_key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">+</span> <span class="n">solv_add</span><span class="p">})</span>

            <span class="c1"># sort all entries in list</span>
            <span class="n">last_atom_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sorted_energy_groups</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">energy_groups</span><span class="p">)):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">energy_groups</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">last_atom_count</span>
                <span class="n">sorted_energy_groups</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ind</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
                <span class="n">last_atom_count</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># adapt energy groups in IMD with sorted list of energy groups created above</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">FORCE</span><span class="o">.</span><span class="n">adapt_energy_groups</span><span class="p">(</span><span class="n">energy_groups</span><span class="o">=</span><span class="n">sorted_energy_groups</span><span class="p">)</span>

        <span class="c1"># Multibath:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;MULTIBATH&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;MULTIBATH&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last_atoms_baths</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_multibath</span><span class="p">:</span>
                <span class="n">sorted_last_atoms_baths</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">last_atoms_baths</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">solute_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">})</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">last_atoms_baths</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">start_position</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_info</span><span class="o">.</span><span class="n">number_of_atoms</span><span class="p">})</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">solv_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="o">.</span><span class="n">number_of_atoms</span>
                    <span class="c1"># raise Exception(&quot;The imd adaptation for nonLigand res and multibath was not written yet!&quot;)</span>
                    <span class="c1"># TODO: Do something for non-Ligands better in future</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">solv_add</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">max_key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last_atoms_baths</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">last_atoms_baths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">last_atoms_baths</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">max_key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">solvent_info</span><span class="o">.</span><span class="n">number_of_atoms</span> <span class="o">+</span> <span class="n">solv_add</span><span class="p">})</span>

                <span class="n">last_atom_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">sorted_last_atoms_baths</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">last_atoms_baths</span><span class="p">)):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">last_atoms_baths</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">last_atom_count</span>
                    <span class="n">sorted_last_atoms_baths</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">value</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ind</span><span class="p">})</span>
                    <span class="n">last_atom_count</span> <span class="o">=</span> <span class="n">value</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="o">.</span><span class="n">MULTIBATH</span><span class="o">.</span><span class="n">adapt_multibath</span><span class="p">(</span><span class="n">last_atoms_bath</span><span class="o">=</span><span class="n">sorted_last_atoms_baths</span><span class="p">)</span>

        <span class="n">ff_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">ff_name</span> <span class="o">==</span> <span class="s2">&quot;openforcefield&quot;</span>
            <span class="ow">or</span> <span class="n">ff_name</span> <span class="o">==</span> <span class="s2">&quot;smirnoff&quot;</span>
            <span class="ow">or</span> <span class="n">ff_name</span> <span class="o">==</span> <span class="s2">&quot;off&quot;</span>
            <span class="ow">or</span> <span class="n">ff_name</span> <span class="o">==</span> <span class="s2">&quot;openff&quot;</span>
            <span class="ow">or</span> <span class="n">ff_name</span> <span class="o">==</span> <span class="s2">&quot;amberff_gaff&quot;</span>
        <span class="p">):</span>
            <span class="c1"># adjust harmonic forces</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;COVALENTFORM&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;COVALENTFORM&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please make sure to use harmonic forces for simulations with OpenForceField torsions&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;COVALENTFORM&quot;</span><span class="p">,</span> <span class="n">imd_blocks</span><span class="o">.</span><span class="n">COVALENTFORM</span><span class="p">(</span><span class="n">NTBBH</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">NTBAH</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">NTBDN</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="c1"># adjust amberscale for LJ forces</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;AMBER&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;AMBER&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please make sure to use amber LJ forces for simulations with OpenForceField LJ parameters&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imd</span><span class="p">,</span> <span class="s2">&quot;AMBER&quot;</span><span class="p">,</span> <span class="n">imd_blocks</span><span class="o">.</span><span class="n">AMBER</span><span class="p">(</span><span class="n">AMBER</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">AMBSCAL</span><span class="o">=</span><span class="mf">1.2</span><span class="p">))</span></div>

<div class="viewcode-block" id="Gromos_System.generate_posres"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.generate_posres">[docs]</a>    <span class="k">def</span> <span class="nf">generate_posres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residues</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">keep_residues</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">gen_possrespec</span><span class="p">(</span><span class="n">residues</span><span class="o">=</span><span class="n">residues</span><span class="p">,</span> <span class="n">keep_residues</span><span class="o">=</span><span class="n">keep_residues</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnf</span><span class="o">.</span><span class="n">gen_refpos</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        IO - Files:</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Gromos_System.read_files"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.read_files">[docs]</a>    <span class="k">def</span> <span class="nf">read_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;did not find the required &quot;</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot; found&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;did not find the optional &quot;</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot; found&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Gromos_System.write_files"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.write_files">[docs]</a>    <span class="k">def</span> <span class="nf">write_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cnf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">imd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">top</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ptp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">disres</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">posres</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refpos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">qmmm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">mol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="nb">all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="n">control</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="nb">all</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_files_key</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">control</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">top</span><span class="p">,</span>
                <span class="s2">&quot;imd&quot;</span><span class="p">:</span> <span class="n">imd</span><span class="p">,</span>
                <span class="s2">&quot;cnf&quot;</span><span class="p">:</span> <span class="n">cnf</span><span class="p">,</span>
                <span class="s2">&quot;ptp&quot;</span><span class="p">:</span> <span class="n">ptp</span><span class="p">,</span>
                <span class="s2">&quot;disres&quot;</span><span class="p">:</span> <span class="n">disres</span><span class="p">,</span>
                <span class="s2">&quot;posres&quot;</span><span class="p">:</span> <span class="n">posres</span><span class="p">,</span>
                <span class="s2">&quot;refpos&quot;</span><span class="p">:</span> <span class="n">refpos</span><span class="p">,</span>
                <span class="s2">&quot;qmmm&quot;</span><span class="p">:</span> <span class="n">qmmm</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">control</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">control</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">file_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is empty , can not be written!&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">_future_file</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is promised , can not be written: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_obj</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Write out: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_obj</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;did not find the required &quot;</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot; found&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;did not find the required &quot;</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot; found&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mol</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mol&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Gromos_System.get_file_paths"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.get_file_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            get the paths of the files in a dict.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, str]</span>
<span class="sd">            returns alle file paths, with attribute file name as key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">file_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_files</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RDKIT Fun</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Gromos_System.rdkitImport"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.rdkitImport">[docs]</a>    <span class="k">def</span> <span class="nf">rdkitImport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputMol</span><span class="p">:</span> <span class="n">Chem</span><span class="o">.</span><span class="n">rdchem</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">inputMol</span></div>

<div class="viewcode-block" id="Gromos_System.rdkit2Gromos"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.rdkit2Gromos">[docs]</a>    <span class="k">def</span> <span class="nf">rdkit2Gromos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># generate top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span>
            <span class="n">blocktitle</span><span class="o">=</span><span class="s2">&quot;TITLE&quot;</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;topology generated with PyGromos from RDKit molecule: &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;    &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">blocktitle</span><span class="o">=</span><span class="s2">&quot;PHYSICALCONSTANTS&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">blocktitle</span><span class="o">=</span><span class="s2">&quot;TOPVERSION&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;2.0&quot;</span><span class="p">]])</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialize</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Gromos_System.save"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">FileIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">safe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method stores the Class as binary obj to a given path or fileBuffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">safe_skip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">safe</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;FOUND ALREADY A FILE! SKIPPING!&quot;</span><span class="p">)</span>
                <span class="n">safe_skip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bufferdWriter</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedWriter</span><span class="p">):</span>
            <span class="n">bufferdWriter</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">bufferdWriter</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Please give as parameter a path:str or a File Buffer. To &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.save&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">safe_skip</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">bufferdWriter</span><span class="p">)</span>
            <span class="n">bufferdWriter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="Gromos_System.load"><a class="viewcode-back" href="../../../../_source/pygromos.files.gromos_system.html#pygromos.files.gromos_system.gromos_system.Gromos_System.load">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">FileIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method stores the Class as binary obj to a given path or fileBuffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">bufferedReader</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">):</span>
            <span class="n">bufferedReader</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Please give as parameter a path:str or a File Buffer.&quot;</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">bufferedReader</span><span class="p">)</span>

        <span class="n">bufferedReader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;cnf&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cnf</span><span class="p">,</span> <span class="s2">&quot;POSITION&quot;</span><span class="p">):</span>
            <span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">residue_list</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">solute_info</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">protein_info</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">non_ligand_info</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">solvent_info</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_cnf</span><span class="o">.</span><span class="n">get_system_information</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_checkpoint_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    super privates - don&#39;t even read!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__SystemConstructionAttributeFinder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            ** DECORATOR **</span>

<span class="sd">            This decorator trys to find input parameters of the function in the gromossystem and will automatically assign those to the function call!</span>
<span class="sd">            functional programming</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        callable</span>
<span class="sd">            returns the wrapped function</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_findGromosSystemAttributes</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># print(&quot;attribute finder&quot;, func.__name__, args, kwargs)</span>

            <span class="c1"># collect input parameters present in system/ replace them with</span>
            <span class="n">tmp_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">attr_key</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;in_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="c1"># print(attr_key)</span>
                <span class="k">if</span> <span class="s2">&quot;in&quot;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">grom_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_key</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grom_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">grom_obj</span><span class="p">})</span>

                    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">grom_obj</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grom_obj</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">tmp_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span> <span class="o">+</span> <span class="s2">&quot;/tmp_in_file.&quot;</span> <span class="o">+</span> <span class="n">grom_obj</span><span class="o">.</span><span class="n">_gromos_file_ending</span>
                        <span class="n">grom_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp_file_path</span><span class="p">)</span>
                        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">tmp_file_path</span><span class="p">})</span>
                        <span class="n">tmp_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_file_path</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">grom_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">grom_obj</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># make sure filestatus is good :)</span>
                        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">grom_obj</span><span class="o">.</span><span class="n">path</span><span class="p">})</span>

            <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gromosPP</span><span class="o">.</span><span class="vm">__class__</span><span class="p">),</span> <span class="n">args</span><span class="p">))</span>

            <span class="c1"># execute function</span>
            <span class="c1"># print(&quot;attibuteFinder 2:&quot;, func.__name__, args, kwargs)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gromosPP</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># remove tmp_files</span>
            <span class="p">[</span><span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tmp_files</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">r</span>

        <span class="c1"># Override signature for usage in jupyter env or IDE</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">red_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">attr_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;in_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;in&quot;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">attr_key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">red_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
        <span class="n">red_sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">red_params</span><span class="p">)</span>
        <span class="n">_findGromosSystemAttributes</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">red_sig</span>

        <span class="k">return</span> <span class="n">_findGromosSystemAttributes</span>

    <span class="k">def</span> <span class="nf">__SystemConstructionUpdater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            ** DECORATOR **</span>
<span class="sd">            This decorator trys to find output parameters of the function in the gromossystem and will automatically update the state of those attributes!</span>
<span class="sd">            functional programming</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: callable</span>
<span class="sd">            the function to be wrapped</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        func</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_updateGromosSystem</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># print(&quot;updater&quot;, func.__name__, args, kwargs)</span>

            <span class="c1"># collect out_paths</span>
            <span class="n">update_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">attr_key</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;out_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span> <span class="o">+</span> <span class="s2">&quot;/tmp_out_file.&quot;</span> <span class="o">+</span> <span class="n">attr_key</span><span class="p">})</span>
                    <span class="n">update_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">attr_key</span><span class="p">})</span>

            <span class="c1"># execute function</span>
            <span class="c1"># print(&quot;updater2&quot;, func.__name__, args, kwargs)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># print(&quot;updater3&quot;, func.__name__, args, kwargs)</span>

            <span class="c1"># update attribute states and remove tmp files.</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_dict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">bash</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">r</span>

        <span class="c1"># Override signature for usage in jupyter env or IDE</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">red_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="s2">&quot;path&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">red_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
        <span class="n">red_sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">red_params</span><span class="p">)</span>
        <span class="n">_updateGromosSystem</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">red_sig</span>

        <span class="k">return</span> <span class="n">_updateGromosSystem</span>

    <span class="k">def</span> <span class="nf">__ionDecorator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            ** DECORATOR **</span>
<span class="sd">            This Helper Decorator should be removed soon! it helps with gromosPP ion,</span>
<span class="sd">            to add the ion params to the topology. -&gt; Convenience for tech debt</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: callable</span>
<span class="sd">            the function to be wrapped</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        func</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">generate_ion_top</span><span class="p">(</span>
            <span class="n">in_building_block_lib_path</span><span class="o">=</span><span class="n">Gromos54A7</span><span class="o">.</span><span class="n">mtb</span><span class="p">,</span> <span class="n">in_parameter_lib_path</span><span class="o">=</span><span class="n">Gromos54A7</span><span class="o">.</span><span class="n">ifp</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
            <span class="c1"># execute function</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">top_cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">work_folder</span> <span class="o">+</span> <span class="s2">&quot;/aux_tmp.top&quot;</span>

            <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;negative&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">nIons</span><span class="p">,</span> <span class="n">ion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;negative&quot;</span><span class="p">]</span>
                <span class="n">sequence</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ion</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">nIons</span>
            <span class="k">if</span> <span class="s2">&quot;positive&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">nIons</span><span class="p">,</span> <span class="n">ion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">]</span>
                <span class="n">sequence</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ion</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">nIons</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span><span class="o">.</span><span class="n">make_top</span><span class="p">(</span>
                <span class="n">in_building_block_lib_path</span><span class="o">=</span><span class="n">in_building_block_lib_path</span><span class="p">,</span>
                <span class="n">in_parameter_lib_path</span><span class="o">=</span><span class="n">in_parameter_lib_path</span><span class="p">,</span>
                <span class="n">in_sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">,</span>
                <span class="n">in_solvent</span><span class="o">=</span><span class="s2">&quot;H2O&quot;</span><span class="p">,</span>
                <span class="n">out_top_path</span><span class="o">=</span><span class="n">top_cl</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">+=</span> <span class="n">Top</span><span class="p">(</span><span class="n">top_cl</span><span class="p">)</span>
            <span class="c1"># bash.remove_file(top_cl)</span>

            <span class="k">return</span> <span class="n">r</span>

        <span class="c1"># Override signature for usage in jupyter env or IDE</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">sig2</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span><span class="o">.</span><span class="n">make_top</span><span class="p">)</span>

        <span class="n">red_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">sig2</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;in_building_block_lib_path&quot;</span><span class="p">]]</span>
        <span class="n">red_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig2</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;in_parameter_lib_path&quot;</span><span class="p">])</span>
        <span class="n">red_params</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="n">red_sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">red_params</span><span class="p">)</span>
        <span class="n">generate_ion_top</span><span class="o">.</span><span class="n">__signature__</span> <span class="o">=</span> <span class="n">red_sig</span>

        <span class="k">return</span> <span class="n">generate_ion_top</span>

    <span class="k">def</span> <span class="nf">__bind_gromosPPFuncs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;bin&quot;</span><span class="p">)]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">f</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SystemConstructionUpdater</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__SystemConstructionAttributeFinder</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gromosPP</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">func</span>
            <span class="p">}</span>
            <span class="c1"># this is clunky and needs to be removed in future</span>
            <span class="n">rewrap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ionDecorator</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">])</span>
            <span class="n">v</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="n">rewrap</span><span class="p">})</span>
            <span class="p">[</span><span class="n">exclude_pickle</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">f</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">func</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Benjamin Ries, Mark Lehner, Salome Rieder. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.3.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>